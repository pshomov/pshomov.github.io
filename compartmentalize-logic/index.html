<!doctype html>
<!--[if lt IE 7]>
    <html class="no-js lt-ie9 lt-ie8 lt-ie7">
    <![endif]-->
    <!--[if IE 7]>
        <html class="no-js lt-ie9 lt-ie8">
        <![endif]-->
        <!--[if IE 8]>
            <html class="no-js lt-ie9">
            <![endif]-->
            <!--[if gt IE 8]>
                <!-->
                <html class="no-js">
                <!--<![endif]-->
                <meta charset="utf-8">
                <meta http-equiv="X-UA-Compatible" content="IE=edge">
                <title></title>
                <meta name="description" content="This is Petar's blog about programming and design">
                <link rel="me" type="text/html" href="http://twitter.com/pshomov">                    
                <link rel='alternate' type='application/atom+xml' title='Atom feed' href='https://pshomov.github.io/atom.xml'>
                <link rel='alternate' type='application/rss+xml' title='RSS feed' href='https://pshomov.github.io/rss.xml'>
                <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes" />
                <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

                <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

                <link rel="stylesheet" href="/styles/vendor.ebca39d7.css">

                <link rel="stylesheet" href="/styles/main.c278e831.css">
                
                <script src="https://rawgit.com/natevw/fermata/master/fermata.js"></script>                
                <script src="/js/vendor.28bec23a.js"></script>
                
                </head>
                
                <body>
                    <!--[if lt IE 7]>
                        <p class="browsehappy">You are using an
                            <strong>outdated</strong>browser. Please
                            <a href="http://browsehappy.com/">upgrade
    your browser</a>to improve your experience.</p>
                    <![endif]-->
                    <!--[if lt IE 9]>
                        <script src="bower_components/es5-shim/es5-shim.js"></script>
                        <script src="bower_components/json3/lib/json3.min.js"></script>
                    <![endif]-->
                    <!-- Add your site or application content here -->
                    <div id="container">
                        <div class="aboutme my_name_is">
                            <div class="picture-of-me block_center"></div>
                            <h4 class="my_name_is">
                                <a href="/introduction">My name is Petar</a>
                            </h4>
                            <h6>This is where I write about the things I find interesting</h6>
                            <div class="hcenter">
                                <span>                                    
                                    <a href="http://github.com/pshomov"><i class="fa fa-github fa-3x badge"></i></a></a>
                                    <a href="http://twitter.com/pshomov"><i class="fa fa-twitter fa-3x badge"></i></a>
                                </span>
                            </div>
                        </div>
                        <div class="content">
  <h1 href="top">Compartmentalize logic</h1>
  <time>2015-10-20</time>
  <p>Alright, this is the thing that I have had burning desire to share with you. I think it is awesome. But before I get to that I would like to give you a quick outline how I got here.
My <a href="/common-problems-with-mvvm-apps-take-two/">last post</a> I was telling you about the friction I experienced trying to build a Xamarin Forms MVVM. I considered <a href="http://reactiveui.net">ReactiveUI</a> since I found it really really promising. I also found it to be too much of an all-in kind of proposition and the lack of documentation to even get started really killed it for me. Turned to JavaScript community in search of good ideas, considered Flux and almost started on a Flux-inspired port in .NET. 
And then I bumped into <a href="http://redux.js.org">Redux</a> and I <em>loved</em> everything about it - simple, powerful, versatile. It&#39;s like I head a blurry image of what I wanted and Redux just put everything in focus. I immediately knew it was exactly what I was looking for.</p>
<p>So I rushed out and made a port to .NET which I call <a href="http://github.com/pshomov/reducto">Reducto</a>.</p>
<p>Let me try to explain the basic concepts in Reducto:</p>
<ul>
<li><strong>Action</strong> - an object which describes what has happened - LoggingIn, SignedOut, etc. The object contains all the information relevant to the action - username, password, status, etc. Usually there are many actions in an app</li>
<li><strong>Reducer</strong> - a side-effect free function that receives the current state of your app and an action. If the reducer does not know how to handle the action it should return the state as is. If the reducer can handle the action it makes a copy of the state, it modifies it in response to the action and returns the copy.</li>
<li><strong>Store</strong> - it is an object that contains your whole app&#39;s state. It also has a reducer. We <em>dispatch</em> an action to the store which hands it to the reducer together with the current app state and then uses the return value of the reducer as the new state of the app. There is only one store in your app. It&#39;s created when your app starts and gets destroyed when your app quits. Your MVVM view models can <em>subscribe</em> to be notified when the state changes so they can update themselves accordingly. </li>
</ul>
<p>Having a single reducer operate on the whole state of the app probably sounds a bit scary but the trick is to <a href="https://en.wikibooks.org/wiki/Muggles%27_Guide_to_Harry_Potter/Magic/Reducto#Overview"><em>compose</em> the reducer from many smaller, simpler reducers</a> which distribute the responsibility of updating differents parts of the state. </p>
<p>The basic idea is to create a store and give it a reducer(a composite one quite likely). We dispatch actions to the store which, with the help of reducers, updates the state. Rinse and repeat.</p>
<p>Besides these core concepts in Reducto(and Redux) there are a couple more that are quite useful:</p>
<ul>
<li><strong>Async action</strong> - a function that may have side effects. This is where you talk to your database, call a web service, navigate to a view model, etc. Async actions can also dispatch actions (as described in the core concepts). </li>
<li><strong>Middleware</strong> - these are functions that can be hooked in the Store dispatch mechanism so you can do things like logging, profiling, authorization, etc. It&#39;s sort of a plugin mechanism which can be quite useful.</li>
</ul>
<p>Let&#39;s jump right in and see an example. Let&#39;s look at a very simple model which is only concerned with logging a user in. To make things simple I have presented this in the form of a unit test with the assertions showing what the expectations are</p>
<script src="https://gist.github.com/pshomov/d3cd0ffa326dc042cf31.js"></script>

<p>The example starts off with defining the app state - LoginState. Point of interest here is that it is a <code>struct</code>. Remember that app state is passed to the reducer which is supposed to return a copy of it. <code>Struct</code>s have the benefit of being passed by value by default so they get copied naturally whenever they are passed as an argument.</p>
<p>Defined are two actions - LoginStarted and LoginSucceeded. They contain interesting information submitted from the user in the case of the former action and the authenticating service for the latter one.<br>
On Line 31 we define a reducer for the app state and then we define how we handle both actions. On a side note, if an action is dispatched that is not handled by the reducer, he sends the app state unmodified back.</p>
<p>Line 45 defines the app store and let the store have its reducer.<br>
Line 47 we see a subscription to the store, which gets notified whenever there is an update to the state. In line 61 we remove the subscription;</p>
<p>So here are the benefits that I see</p>
<ul>
<li>the logic is isolated in those reducers</li>
<li>definining the reducers is very simple and does not require creating classes, inheriting or anything like that. A function is enough.</li>
<li>testing is extremely simple - dispatch some actions, assert on the state</li>
<li>framework agnostic - MVVM, MVC, WebForms apps can use it, but also this seems like an all around good way to structure any kind of app really.</li>
</ul>
<p>A few interesting statistics regarding Reducto</p>
<ul>
<li>linus of code - ~260</li>
<li>dependencies - 0</li>
<li>packaging - <a href="https://www.nuget.org/packages/Reducto/">NuGet PCL</a></li>
</ul>
<p>In my next post I will dive a bit deeper in Reducto - Async actions and Composite reducers and connecting all of this in a Xamarin Forms app. 
The code for that post is already in development <a href="https://github.com/pshomov/reducto.sample">over here</a>.</p>
<p>And please, do share your thoughs in the comments ;) </p>

  
  <div class="comments-title" href="comments">Comments (<a href="/comments-powered-by-github/">powered by GitHub issues</a>):</div>    
  <div id="comments" class="comments">
    <div class="hcenter spinner">
    </div>
  </div>
  <div class="hcenter comments__post"><a class="button" href="https://github.com/pshomov/pshomov.github.io/issues/5">Post your comment&nbsp;<i class="fa fa-github"></i></a></div>
  <script>
    function formatCommentTimestamp(timestamp) {
      return timestamp.toLocaleString();
    }
    function loadComments(data) {
      var comments = "";
      for (var i=0; i<data.length; i++) {
        var cuser = data[i].user.login;
        var cuserlink = "https://www.github.com/" + data[i].user.login;
        var clink = "https://github.com/pshomov/pshomov.github.io/issues/5#issuecomment-" + data[i].url.substring(data[i].url.lastIndexOf("/")+1);
       var cbody = data[i].body;
       var cavatarlink = data[i].user.avatar_url;
       var cdate = formatCommentTimestamp(new Date(data[i].created_at));
    
       comments += "<div class='comment'>"+'<img src="' + cavatarlink + '" class="avatar">'+"<div class='comment__info'>"+"<div class='comment__header'><a class='comment__user' href=\""+ cuserlink + "\">" + cuser + "</a>" + "<a class='comment__date' href=\"" + clink + "\">" + cdate + "</a></div><div class='comment__body'>" + marked(cbody) + "</div></div></div>";
     }
     if (comments == ""){
       comments = '<div class="hcenter">No comments have been posted yet, wanna go first? <i class="fa fa-hand-o-down"></i></div>';
     }
     document.getElementById("comments").innerHTML = comments;
    }
    var site = fermata.json('https://api.github.com');
    
    site('repos','pshomov', 'pshomov.github.io','issues','5', 'comments').get(function (err, data, headers){
      if (err == null){
       loadComments(data); 
      }
    });
  </script>  
  
</div>
                        <!-- <div class="links">links</div> --></div>
                    <!-- Google Analytics: change UA-XXXXX-X to be your site's ID -->
                    <script>
                        (function(i, s, o, g, r, a, m) {
                            i['GoogleAnalyticsObject'] = r;
                            i[r] = i[r] || function() {
                                (i[r].q = i[r].q || []).push(arguments)
                            }, i[r].l = 1 * new Date();
                            a = s.createElement(o),
                            m = s.getElementsByTagName(o)[0];
                            a.async = 1;
                            a.src = g;
                            m.parentNode.insertBefore(a, m)
                        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
                    
                        ga('create', 'UA-50877599-1', 'pshomov.github.io');
                        ga('send', 'pageview');
                    </script>
                </body>
                
                </html>