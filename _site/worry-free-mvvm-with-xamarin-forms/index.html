<!doctype html>
<!--[if lt IE 7]>
    <html class="no-js lt-ie9 lt-ie8 lt-ie7">
    <![endif]-->
    <!--[if IE 7]>
        <html class="no-js lt-ie9 lt-ie8">
        <![endif]-->
        <!--[if IE 8]>
            <html class="no-js lt-ie9">
            <![endif]-->
            <!--[if gt IE 8]>
                <!-->
                <html class="no-js">
                <!--<![endif]-->
                <meta charset="utf-8">
                <meta http-equiv="X-UA-Compatible" content="IE=edge">
                <title></title>
                <meta name="description" content="This is Petar's blog about programming and design">
                <link rel="me" type="text/html" href="http://twitter.com/pshomov">                    
                <link rel='alternate' type='application/atom+xml' title='Atom feed' href='https://pshomov.github.io/atom.xml'>
                <link rel='alternate' type='application/rss+xml' title='RSS feed' href='https://pshomov.github.io/rss.xml'>
                <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes" />
                <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
                <!-- build:css(.tmp) styles/main.css -->
                <link rel="stylesheet" href="/normalize-css/normalize.css">
                <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
                <link rel="stylesheet" href="/css/site.css">
                <!-- <link rel="stylesheet" href="styles/fonts.css">
 -->
                <!-- endbuild -->
                <script src="https://rawgit.com/natevw/fermata/master/fermata.js"></script>                
                </head>
                
                <body>
                    <!--[if lt IE 7]>
                        <p class="browsehappy">You are using an
                            <strong>outdated</strong>browser. Please
                            <a href="http://browsehappy.com/">upgrade
    your browser</a>to improve your experience.</p>
                    <![endif]-->
                    <!--[if lt IE 9]>
                        <script src="bower_components/es5-shim/es5-shim.js"></script>
                        <script src="bower_components/json3/lib/json3.min.js"></script>
                    <![endif]-->
                    <!-- Add your site or application content here -->
                    <div id="container">
                        <div class="aboutme my_name_is">
                            <div class="picture-of-me block_center"></div>
                            <h4 class="my_name_is">
                                <a href="/introduction">My name is Petar</a>
                            </h4>
                            <h6>This is where I write about the things I find interesting</h6>
                            <div class="hcenter">
                                <span>                                    
                                    <a href="http://github.com/pshomov"><i class="fa fa-github fa-3x badge"></i></a></a>
                                    <a href="http://twitter.com/pshomov"><i class="fa fa-twitter fa-3x badge"></i></a>
                                </span>
                            </div>
                        </div>
                        <div class="content">
  <h1>Worry-free MVVM with Xamarin Forms</h1>
  <time>2015-05-25</time>
  <p><strong>TL;DR</strong> - Super-clean MVVM example with automatic Command status updates <a href="https://github.com/pshomov/mvvmeasy">here</a></p>
<hr>
<p>Xamarin Forms is great for writing decent looking applications on all three major mobile platforms - iOS, Android and Windows Mobile. The Xaml support and databindings are great help to keep things clean and simple. </p>
<p>So I am working on a Xamarin Forms project where we were in the process of choosing some framework or library to help us with implementing the MVVM pattern and more specifically the view models where it is necessary to send notifications as properties get changed. We looked at <a href="http://www.mvvmlight.net">MvvmLight</a> as well as a preview version of <a href="http://brianlagunas.com/first-look-at-the-prism-for-xamarin-forms-preview/">Prism</a>. Both of them provide a base class which has helper methods for implementing properties with sending notifications. Here is how a simple Login view model looks with Prism</p>
<script src="https://gist.github.com/pshomov/e35832cbf51c82ac50c7.js"></script>

<p>A couple of things to notice here:</p>
<ul>
<li>Lot&#39;s of repetitive code in the property getters and setters</li>
<li>Extra complexity in both the property setters and the command itself due to keeping the enabled/disabled state of the Login command in sync (lines 22, 30, 63 and 72)</li>
<li>We need extra (and may I say not particularly pretty) testing of whether the property change notifications were sent and the update of the Login command status was triggered</li>
</ul>
<p>In order to clean things up let&#39;s use <a href="https://github.com/Fody/PropertyChanged#your-code">Fody.PropertyChanged</a> and get rid of Prism&#39;s BindableBase. If you have not looked at this MVVM specialized weaver, please take your time now to get introduced. I think you might like it.
And here is how the new model looks like:</p>
<script src="https://gist.github.com/pshomov/eb3f85471e632bbcb9f6.js"></script>

<p>I think Fody.PropertyChanged is great, it helps us get rid of those super-boring, error-prone property getters and setters but unfortunately does nothing about updating the Login command state. In fact this version of the model does not work correctly since the Login command never gets enabled. One way to fix this problem is by making the Login command state be more MVVM-y. To do that let&#39;s use <a href="https://github.com/pshomov/mvvmeasy/blob/master/Infrastructure/MVVMCommand.cs">MVVMCommand</a> which is exactly like a normal Xamarin Forms Command except the second parameter has to be a lambda that returns the value of a property. Let&#39;s see how the fixed model looks:</p>
<script src="https://gist.github.com/pshomov/4b158ca0b0801809b0d6.js"></script>

<p>Notice how in line 28 the state of the command becomes extracted to a property - IsLoginEnabled. The reason that is good is because it plays on the strength of Fody.PropertyChanged. <strong>Meaning that Fody.PropertyChanged sends out ProprtyChanged notifications about IsLoginEnabled whenever one of the properties it&#39;s value is based on changes</strong>. Now all MVVMCommand needs to do is listen for those notifications and do the updating of the enabled/disabled command state. It&#39;s actually pretty simple:</p>
<script src="https://gist.github.com/pshomov/4e2b51ef94ca3c6cc508.js"></script>

<p>Testing this model now becomes really a rather simple and elegant exercise of changing properties and asserting on the value of other properties and no need to worry about bookkeeping regarding who update who.</p>
<p>Hope this makes sense, the source for a complete example is on <a href="https://github.com/pshomov/mvvmeasy">GitHub</a>.</p>
<p><strong>BTW</strong>: Sorry for not providing a way to do comments, now actively working on it, I promise. Meanwhile please <a href="https://github.com/pshomov/mvvmeasy/issues">create an issue on the example</a> and let&#39;s have the conversation over there ;) </p>

  
  <div class="comments-hat">
    <div class="comments-title">Comments:</div><div class="comments-post"><button>Post your comment&nbsp;<i class="fa fa-github"></i></button></div>    
  </div>
  <div id="comments" class="comments"></div>
  
  <script>
    function formatCommentTimestamp(timestamp) {
      return timestamp.toLocaleString();
    }
    function loadComments(data) {
      var comments = "";
      for (var i=0; i<data.length; i++) {
        var cuser = data[i].user.login;
        var cuserlink = "https://www.github.com/" + data[i].user.login;
        var clink = "https://github.com/pshomov/pshomov.github.io/issues/1#issuecomment-" + data[i].url.substring(data[i].url.lastIndexOf("/")+1);
       var cbody = data[i].body;
       var cavatarlink = data[i].user.avatar_url;
       var cdate = formatCommentTimestamp(new Date(data[i].created_at));
    
       comments += "<div class='comment'>"+'<img src="' + cavatarlink + '" class="avatar">'+"<div class='comment__info'>"+"<div class='comment__header'><a class='comment__user' href=\""+ cuserlink + "\">" + cuser + "</a>" + "<a class='comment__date' href=\"" + clink + "\">" + cdate + "</a></div><div class='comment__body'>" + cbody + "</div></div></div>";
     }
     document.getElementById("comments").innerHTML = comments;
    }
    var site = fermata.json('https://api.github.com');
    
    site('repos','pshomov', 'pshomov.github.io','issues','1', 'comments').get(function (err, data, headers){
      if (err == null){
       loadComments(data); 
      }
    });
  </script>  
  
</div>
                        <!-- <div class="links">links</div> --></div>
                    <!-- Google Analytics: change UA-XXXXX-X to be your site's ID -->
                    <script>
                        (function(i, s, o, g, r, a, m) {
                            i['GoogleAnalyticsObject'] = r;
                            i[r] = i[r] || function() {
                                (i[r].q = i[r].q || []).push(arguments)
                            }, i[r].l = 1 * new Date();
                            a = s.createElement(o),
                            m = s.getElementsByTagName(o)[0];
                            a.async = 1;
                            a.src = g;
                            m.parentNode.insertBefore(a, m)
                        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
                    
                        ga('create', 'UA-50877599-1', 'pshomov.github.io');
                        ga('send', 'pageview');
                    </script>
                </body>
                
                </html>